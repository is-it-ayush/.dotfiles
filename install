#!/usr/bin/zsh

if [[ -z $STOW_FOLDERS ]]; then
    export STOW_FOLDERS="zsh,nvim,alacritty,home"
fi

if [[ -z $DOTFILES ]]; then
    export DOTFILES=$HOME/.dotfiles
fi

pushd $DOTFILES > /dev/null
for folder in $(echo $STOW_FOLDERS | sed "s/,/ /g")
do
  echo "[config] Linking $folder."
  if [[ $folder == "zsh" || $folder == "home" ]]; then # except for zsh and home, treat every other folder for .config
    stow -t $HOME $folder
  else
    # Create directory if it doesn't exist.
    if [[ ! -d $HOME/.config/$folder ]]; then
      mkdir $HOME/.config/$folder
    fi
    stow -t $HOME/.config/$folder $folder
  fi
done
popd > /dev/null

# we setup packer for nvim to recognize lua.
PACKER_PATH=".local/share/nvim/site/pack/packer/start/packer.nvim"
if [[ ! -d $HOME/$PACKER_PATH ]]; then
  git clone --depth 1 https://github.com/wbthomason/packer.nvim $HOME/$PACKER_PATH
  echo "[nvim] Installed packer on $PACKER_PATH"
fi

# install some useful programs.
if ! dpkg -l | grep -q "ripgrep"; then
  echo "[app] ripgrep not found, installing..."
  sudo apt-get install ripgrep
fi

echo "[config] done. :3"
